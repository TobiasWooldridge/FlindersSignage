<html ng-app="signage">
<head>
    <title>Flinders Signage</title>
    <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.0.7/angular.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.0.7/angular-sanitize.js"></script>
    <link href="bootstrap/css/bootstrap.css" rel="stylesheet"/>
    <link href="bootstrap/css/bootstrap-theme.css" rel="stylesheet"/>


    <link href="styles.css" rel="stylesheet"/>
</head>
<body>

<div ng-controller="SlidesController">
    <div ng-controller="NewsController">
        <div ng-repeat="article in [news.latestArticle]" ng-include="'views/news-article.html'"></div>
    </div>

    <div ng-controller="TimetableController">
        <div ng-include="'views/building.html'"></div>
    </div>
</div>

<script>
    function bootstrapAngular() {
        var API_PATH = "http://flinders-signage.herokuapp.com/api/v1/";
//        var API_PATH = "http://127.0.0.1:3000/api/v1/";

        var signage = angular.module('signage', ['ngSanitize']);

        signage.factory('buildingFactory', function ($http) {
            return {
                getBuildingsAsync: function (building_code, room_code, callback) {
                    $http.get(API_PATH + 'buildings.json').success(callback);
                },
                getBuildingAsync: function (building_code, callback) {
                    $http.get(API_PATH + 'buildings/' + building_code + '.json').success(callback);
                }
            };
        });

        signage.factory('newsFactory', function ($http) {
            return {
                getNewsAsync: function (callback) {
                    $http.get(API_PATH + 'news.json').success(callback);
                }
            };
        });

        signage.controller('SlidesController', function ($scope) {
        });

        signage.controller('NewsController', function ($scope, newsFactory) {
            newsFactory.getNewsAsync(function (data, status, headers, config) {
                $scope.news = {
                    posts: data,
                    latestArticle: data[0]
                };
            });
        });

        signage.controller('TimetableController', function ($scope, buildingFactory, $timeout) {
            var poll = function() {
                buildingFactory.getBuildingAsync('IST', function (building, status, headers, config) {
                    $scope.building = building;
                });

                $timeout(poll, 1000);
            };

            poll();
        });
    };

    bootstrapAngular();
</script>
</body>
</html>